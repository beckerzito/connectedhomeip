# Copyright (c) 2023 Project CHIP Authors
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# Auto-generated scripts for harness use only, please review before automation. The endpoints and cluster names are currently set to default

name: 204.2.5. [TC-OVENOPSTATE-2.5] Optional Events with DUT as Server

PICS:
    - OVENOPSTATE.S

config:
    nodeId: 0x12344321
    cluster: "Oven Cavity Operational State"
    endpoint: 0

tests:
    - label: "Note"
      verification: |
          This test case can be continuted only when countdown-time read in step 5 is not null
      disabled: true

    - label: "Step 1: Commission DUT to TH"
      cluster: "DelayCommands"
      command: "WaitForCommissionee"
      arguments:
          values:
              - name: "nodeId"
                value: nodeId

    - label: "Step 2: Set up a subscription to the OperationCompletion event"
      PICS: OVENOPSTATE.S.E01
      verification: |
          ./chip-tool interactive start

          ovencavityoperationalstate read-event operation-completion 1 1

          [1702376916.193452][4893:4896] CHIP:DMG: ReportDataMessage =
          [1702376916.193461][4893:4896] CHIP:DMG: {
          [1702376916.193469][4893:4896] CHIP:DMG:         SubscriptionId = 0x85d7a607,
          [1702376916.193497][4893:4896] CHIP:DMG:         InteractionModelRevision = 11
          [1702376916.193504][4893:4896] CHIP:DMG: }
      disabled: true

    - label: "Step 3: TH reads from the DUT the OperationalState attribute"
      PICS: OVENOPSTATE.S.A0004
      command: "readAttribute"
      attribute: "OperationalState"
      response:
          value: 0
          constraints:
              type: enum8

    - label:
          "Step 4: Manually put the DUT into a state wherein it can receive a
          Start Command"
      verification: |

      disabled: true

    - label: "Step 5: TH reads from the DUT the CountdownTime attribute"
      PICS: OVENOPSTATE.S.A0002
      verification: |
          ./chip-tool ovencavityoperationalstate read countdown-time 1 1

            Via the TH (chip-tool), verify:
            - that CountdownTime attribute contains either null our a uint32 value
            - if non-null, verify that the value is in the range 1 to 259200
            - store the value in 'initialcountdown-time'

           [1690457637.895405][18808:18810] CHIP:DMG: }
           [1690457637.895474][18808:18810] CHIP:TOO: Endpoint: 1 Cluster: 0x0000_0060 Attribute 0x0000_0002 DataVersion: 4112784416
           [1690457637.895503][18808:18810] CHIP:TOO: CountdownTime: null
      disabled: true

    - label: "Step 6: TH sends Start command to the DUT"
      PICS: OVENOPSTATE.S.C02.Rsp && OVENOPSTATE.S.C04.Tx
      command: "Start"
      response:
        values:
          - name: "CommandResponseState"
            value: { ErrorStateID: 0 }

    - label: "Step 7: TH waits for {PIXIT.WAITTIME}"
      verification: |

      disabled: true

    - label: "Step 8: TH reads from the DUT the OperationalState attribute"
      PICS: OVENOPSTATE.S.A0004
      command: "readAttribute"
      attribute: "OperationalState"
      response:
          value: 1
          constraints:
              type: enum8

    - label: "Step 9: TH waits for initial-countdown-time"
      verification: |
          As the initial-countdown-time in null this test cannot be executed further in case of RPI platform.
          Note: The below  log are for instructional purpose. In real scenarios, the actual log may vary depending on the feature implementation in the Reference App.
      disabled: true

    - label: "Step 10: TH sends Stop command to the DUT"
      PICS: OVENOPSTATE.S.C01.Rsp && OVENOPSTATE.S.C04.Tx
      command: "Stop"
      response:
          values:
              - name: "CommandResponseState"
                value: { ErrorStateID: 0 }

    - label:
          "Step 11: erify TH receives an OperationCompletion event from the DUT
          with the following fields populated as follows: 1)CompletionErrorCode
          set to NoError(0x00) 2)TotalOperationalTime is approximately
          initial-countdown-time or null 3)PausedTime is zero"
      PICS: OVENOPSTATE.S.E01
      verification: |
          ovencavityoperationalstate read-event operation-completion 1 1

          [1657193007.841358][5422:5427] CHIP:TOO: Endpoint: 0  Endpoint: 1 Cluster: 0x0000_0060  Event 0x0000_0001
          [1657193007.841387][5422:5427] CHIP:TOO:          Event number: 1
          [1657193007.841409][5422:5427] CHIP:TOO:          Priority: INFO
          [1657193007.841431][5422:5427] CHIP:TOO:          Timestamp: 132146
          [1657193007.841531][5422:5427] CHIP:TOO:   OperationCompletion: {
          [1657193007.841570][5422:5427] CHIP:TOO:     CompletionErrorCode: 0x00
                                                                                        TotalOperationalTime: null
                                                                                          PausedTime: 0
          [1657193007.841594][5422:5427] CHIP:TOO:    }
      disabled: true

    - label: "Step 12: TH reads from the DUT the OperationalState attribute"
      PICS: OVENOPSTATE.S.A0004
      command: "readAttribute"
      attribute: "OperationalState"
      response:
          value: 0
          constraints:
              type: enum8

    - label: "Step 13: Restart DUT and repeat step 5"
      verification: |

      disabled: true

    - label: "Step 14: TH sends Start command to the DUT"
      PICS: OVENOPSTATE.S.C02.Rsp && OVENOPSTATE.S.C04.Tx
      command: "Start"
      response:
        values:
          - name: "CommandResponseState"
            value: { ErrorStateID: 0 }

    - label: "Step 15: TH waits for {PIXIT.WAITTIME}"
      verification: |

      disabled: true

    - label: "Step 16: TH reads from the DUT the OperationalState attribute"
      PICS: OVENOPSTATE.S.A0004
      command: "readAttribute"
      attribute: "OperationalState"
      response:
          value: 1
          constraints:
              type: enum8
     
    - label: "Step 17: TH sends Pause command to the DUT"
      PICS: OVENOPSTATE.S.C00.Rsp && OVENOPSTATE.S.C04.Tx
      command: "Pause"
      response:
        values:
          - name: "CommandResponseState"
            value: { ErrorStateID: 0 }

    - label: "Step 18: TH reads from the DUT the OperationalState attribute"
      PICS: OVENOPSTATE.S.A0004
      command: "readAttribute"
      attribute: "OperationalState"
      response:
          value: 2
          constraints:
              type: enum8

    - label: "Step 19: TH waits for half of initial-countdown-time"
      verification: |

      disabled: true

    - label: "Step 20: TH sends Resume command to the DUT"
      PICS: OVENOPSTATE.S.C03.Rsp && OVENOPSTATE.S.C04.Tx
      command: "Resume"
      response:
        values:
          - name: "CommandResponseState"
            value: { ErrorStateID: 3}

    - label: "Step 21: TH reads from the DUT the OperationalState attribute"
      PICS: OVENOPSTATE.S.A0004
      command: "readAttribute"
      attribute: "OperationalState"
      response:
          value: 1
          constraints:
              type: enum8

    - label: "Step 22: TH waits for initial-countdown-time"
      verification: |
          TH waits for initial-countdown-time
      disabled: true

    - label: "Step 23: TH sends Stop command to the DUT"
      PICS: OVENOPSTATE.S.C01.Rsp && OVENOPSTATE.S.C04.Tx
      command: "Stop"
      response:
        values:
          - name: "CommandResponseState"
            value: { ErrorStateID: 0 }
      verification: |
          ./chip-tool ovencavityoperationalstate stop 1 1

           Via the TH (chip-tool), verify:
           - the response is an instance of OperationalCommandResponse
           - The ErrorStateID field is set to 0x00 (NoError)

          [1689674653.322963][17330:17332] CHIP:DMG: },
          [1689674653.322994][17330:17332] CHIP:DMG: Received Command Response Data, Endpoint=1 Cluster=0x0000_0060 Command=0x0000_0004
          [1689674653.323014][17330:17332] CHIP:TOO: Endpoint: 1 Cluster: 0x0000_0060 Command 0x0000_0004
          [1689674653.323058][17330:17332] CHIP:TOO:   OperationalCommandResponse: {
          [1689674653.323066][17330:17332] CHIP:TOO:     commandResponseState: {
          [1689674653.323076][17330:17332] CHIP:TOO:       ErrorStateID: 0
          [1689674653.323085][17330:17332] CHIP:TOO:      }
          [1689674653.323094][17330:17332] CHIP:TOO:    }
      disabled: true

    - label:
          "Step 24: Verify TH receives an OperationCompletion event with the
          following fields populated as follows: 1. CompletionErrorCode set to
          NoError(0x00) 2. TotalOperationalTime is approximately 1.5 times the
          initial-countdown-time or null 3. PausedTime is 0.5 times the
          initial-countdown-time"
      PICS: OVENOPSTATE.S.E01
      verification: |
          ovencavityoperationalstate read-event operation-completion 1 1

          [1657193007.841358][5422:5427] CHIP:TOO: Endpoint: 0  Endpoint: 1 Cluster: 0x0000_0060  Event 0x0000_0001
          [1657193007.841387][5422:5427] CHIP:TOO:          Event number: 1
          [1657193007.841409][5422:5427] CHIP:TOO:          Priority: INFO
          [1657193007.841431][5422:5427] CHIP:TOO:          Timestamp: 155146
          [1657193007.841531][5422:5427] CHIP:TOO:   OperationCompletion: {
          [1657193007.841570][5422:5427] CHIP:TOO:     CompletionErrorCode: 0x00
          TotalOperationalTime: null
          }
      disabled: true
